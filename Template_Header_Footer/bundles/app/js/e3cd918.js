function loadScriptGMap(){var script=document.createElement("script");script.type="text/javascript";script.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBofkBBwb6eqX0et1V8I3AVrjnXJSHreBY&callback=callMap";script.async=true;document.body.appendChild(script)}loadScriptGMap();function initMap(){if(jQuery(".map-contact").length>0){contactMap()}if(jQuery(".contact-home").find("#map").length==1){var allMarkers=new Array,$infoOffices=jQuery(".addressOfficeInfo"),errorGeo=0;jQuery(".choix-bureaux-contact a").click(function(e){e.preventDefault();var $this=$(this),idOfficePrincipal=$this.parent().attr("data-id-principal"),$addressContact;if($this.hasClass("principal")){i=$("#"+idOfficePrincipal).data("infoOffice");i.display()}else{$addressContact=jQuery(".addressContact");$addressContact.find(".contact-bloc").empty();jQuery.each($infoOffices,function(){var $this=$(this),infoOffice=$this.data("infoOffice");if($this.attr("id")==idOfficePrincipal){$addressContact.find(".nom-contact span").last().text(infoOffice.name)}else{$addressContact.find(".contact-bloc").append(infoOffice.getAdresseDiv(),infoOffice.getCoordsDiv())}})}});jQuery.each($infoOffices,function(){var $this=$(this),infoOffice={latLng:{lat:parseFloat($(this).attr("data-lat"))||undefined,lng:parseFloat($(this).attr("data-lng"))||undefined},name:$(this).attr("data-name"),addressFL:$(this).attr("data-addressfirstline"),addressSL:$(this).attr("data-addresssecondline"),addressTL:$(this).attr("data-addressthirdline"),zipCode:$(this).attr("data-zipcode"),city:$(this).attr("data-city"),phone:$(this).attr("data-phone"),labelphone:$(this).attr("data-labelphone"),mail:$(this).attr("data-mail"),markerImage:$(this).attr("data-type")=="principal"?$markerImage:$markerImageAnnexe,getAddress:function(withBr){var a=this.addressFL+" "+this.addressSL+" "+this.addressTL+" "+this.zipCode+" "+this.city;if(withBr){a=this.addressFL;if(this.addressSL!=""){a+="<br/>"+this.addressSL}if(this.addressTL!=""){a+=", "+this.addressTL}a+="<br/>"+this.zipCode+" "+this.city}return a},getCoords:function(){var a="";if(this.phone!=""){a=this.labelphone+" "+this.phone+"<br/>"}if(this.mail!=""){a+='<a href="mailto:'+this.mail+'">'+this.mail+"</a>"}return a},type:$(this).attr("data-type"),typeaddress:$(this).attr("data-typeaddress"),getAdresseDiv:function(){var c="adresse";c+=this.type=="principal"?"":" annexe";if(this.type=="principal"){return $("<div></div>").addClass(c).html('<i class="fa"></i>'+this.getAddress(true))}else{return $("<div></div>").addClass(c).html('<i class="fa"></i>'+this.typeaddress+"<br/>"+this.getAddress(true))}},getCoordsDiv:function(){var coords=this.getCoords();if(coords.length>0){coords='<i class="fa"></i>'+coords}return $("<div></div>").addClass("coords").html(coords)},display:function(){var $addressContact=$(".addressContact");$addressContact.find(".nom-contact span").last().text(this.name);$addressContact.find(".contact-bloc").empty().append(this.getAdresseDiv(),this.getCoordsDiv())}},geocoder,callbackGeocode=function(nbError,map,allMarkers){errorGeo+=nbError;if($infoOffices.length-errorGeo==allMarkers.length){setZoomByMarkers(map,allMarkers)}};$this.data("infoOffice",infoOffice);if(undefined===infoOffice.latLng.lat||undefined===infoOffice.latLng.lng){geocoder=new google.maps.Geocoder;geocoder.geocode({address:getAddressSanitize(infoOffice.getAddress())},function(results,status){var e=0;if(status===google.maps.GeocoderStatus.OK){infoOffice.latLng=results[0].geometry.location;allMarkers.push(createPinPoint(infoOffice,map))}else{e++}callbackGeocode(e,map,allMarkers)})}else{allMarkers.push(createPinPoint(infoOffice,map))}callbackGeocode(0,map,allMarkers)})}}function initGMap($gpsLat,$gpsLng,$addressLineOne,$addressLineTwo,$addressLineThree,$zipCode,$city,$map,$center,$officeId,$className,$markerImage){if(null===$gpsLat||null===$gpsLng){var $geocoder=new google.maps.Geocoder;var $address=null;$address=$addressLineOne+" "+$addressLineTwo+" "+$addressLineThree+" "+$zipCode+" "+$city;geocodeAddress($geocoder,$map,$address,$center,$officeId,$className,$markerImage)}else{var $myLatLng={lat:parseFloat($gpsLat),lng:parseFloat($gpsLng)};if($center){$map.setCenter(new google.maps.LatLng($myLatLng.lat,$myLatLng.lng))}var $marker=new google.maps.Marker({position:$myLatLng,map:$map,icon:$markerImage});$marker.addListener("click",function(){$("."+$className).hide();$("#"+$officeId).css("display","block")});$allMarkers.push($marker)}}function getAddressSanitize(a){return a.replace(/(CEDEX|BP) [0-9]*/gi,"")}function geocodeAddress($geocoder,$resultsMap,$address,$center,$officeId,$className,$markerImage){var $marker;$markerLoading.push({loading:true});var $i=$markerLoading.length-1;$geocoder.geocode({address:getAddressSanitize($address)},function($results,$status){if($status===google.maps.GeocoderStatus.OK){if($center){$resultsMap.setCenter($results[0].geometry.location)}$marker=new google.maps.Marker({map:$resultsMap,position:$results[0].geometry.location,icon:$markerImage});$marker.addListener("click",function(){$("."+$className).hide();$("#"+$officeId).css("display","block")});$allMarkers.push($marker);$markerLoading[$i].loading=false}else{$markerLoading[$i].loading=false}})}function setZoomByMarkers($map,$allMarkers){var $zoneMarker=new google.maps.LatLngBounds;for(var i=0;i<$allMarkers.length;i++){$zoneMarker.extend($allMarkers[i].getPosition())}if($allMarkers.length>1){$map.fitBounds($zoneMarker);var $zoomMaps=$map.getZoom();if($zoomMaps>15){$map.setZoom(15)}}if(jQuery("body").hasClass("charte2")){var once=false;google.maps.event.addListener($map,"bounds_changed",function(){if(!once){once=true;$mapWidth=$map.getBounds().getNorthEast().lng()-$map.getBounds().getSouthWest().lng();$mapHeight=$map.getBounds().getNorthEast().lat()-$map.getBounds().getSouthWest().lat();$map.setCenter({lat:$map.getBounds().getSouthWest().lat()+$mapHeight/2,lng:$map.getBounds().getSouthWest().lng()+$mapWidth*3/4})}})}}function createPinPoint(infoOffice,map){if(infoOffice.type=="principal"){map.setCenter(infoOffice.latLng)}var marker=new google.maps.Marker({position:infoOffice.latLng,map:map,icon:infoOffice.markerImage,infoOffice:infoOffice});marker.addListener("click",function(){this.infoOffice.display()});return marker}